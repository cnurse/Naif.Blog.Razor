@using Naif.Core.Models

@inherits Naif.Blog.Razor.MenuComponentBase

<section class="categoryList">
    <h2>Categories</h2>
    <MenuBar Menu="@_menu" CssClass="@CssClass"></MenuBar>
</section>

@code {
    private Menu _menu;
    
    [Parameter]
    public int Count { get; set; } = -1;

    protected override async Task OnParametersSetAsync()
    {
        _menu = new Menu
        {
            IsActiveCssClass = "active",
            Items = new List<MenuItem>()
        };
			
        await Task.Run(() =>
        {
            var categories = (Count < 0) 
                        ? Blog.Categories.OrderByDescending(c => c.Count).ToList()
                        : Blog.Categories.OrderByDescending(c => c.Count).Take(Count).ToList();
            foreach (var category in categories)
            {
                var menuItem = new MenuItem()
                {
                    IsActive = false,
                    Link = $"/category/{category.Name}",
                    Text = $"{category.Name} - ({category.Count})"
                };
                _menu.Items.Add(menuItem);
            }
        });
    }
}